(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function s(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return s.prototype=i.prototype,t.prototype=new s,t.__super__=i.prototype,t};Morris.Donut=function(e){function s(e){this.select=t(this.select,this),this.click=t(this.click,this);var i;if(!(this instanceof Morris.Donut))return new Morris.Donut(e);if(this.el="string"==typeof e.element?$(document.getElementById(e.element)):$(e.element),this.options=$.extend({},this.defaults,e),null===this.el||0===this.el.length)throw new Error("Graph placeholder not found.");void 0!==e.data&&0!==e.data.length&&(this.data=e.data,this.values=function(){var t,e,s,r;for(s=this.data,r=[],t=0,e=s.length;e>t;t++)i=s[t],r.push(parseFloat(i.value));return r}.call(this),this.redraw())}return i(s,e),s.prototype.defaults={colors:["#0B62A4","#3980B5","#679DC6","#95BBD7","#B0CCE1","#095791","#095085","#083E67","#052C48","#042135"],backgroundColor:"#FFFFFF",labelColor:"#000000",formatter:Morris.commas},s.prototype.redraw=function(){var t,e,i,s,r,h,n,o,a,l,c,u,p,f,d,g,m,y,v,w,x,M,k;for(this.el.empty(),this.raphael=new Raphael(this.el[0]),e=this.el.width()/2,i=this.el.height()/2,p=(Math.min(e,i)-10)/3,c=0,w=this.values,f=0,m=w.length;m>f;f++)u=w[f],c+=u;for(o=5/(2*p),t=1.9999*Math.PI-o*this.data.length,h=0,r=0,this.segments=[],x=this.values,s=d=0,y=x.length;y>d;s=++d)u=x[s],a=h+o+t*(u/c),l=new Morris.DonutSegment(e,i,2*p,p,h,a,this.options.colors[r%this.options.colors.length],this.options.backgroundColor,r,this.raphael),l.render(),this.segments.push(l),l.on("hover",this.select),l.on("click",this.click),h=a,r+=1;for(this.text1=this.drawEmptyDonutLabel(e,i-10,this.options.labelColor,15,800),this.text2=this.drawEmptyDonutLabel(e,i+10,this.options.labelColor,14),n=Math.max.apply(null,function(){var t,e,i,s;for(i=this.values,s=[],t=0,e=i.length;e>t;t++)u=i[t],s.push(u);return s}.call(this)),r=0,M=this.values,k=[],g=0,v=M.length;v>g;g++){if(u=M[g],u===n){this.select(r);break}k.push(r+=1)}return k},s.prototype.click=function(t){return this.fire("click",t,this.data[t])},s.prototype.select=function(t){var e,i,s,r,h,n;for(n=this.segments,r=0,h=n.length;h>r;r++)i=n[r],i.deselect();return s=this.segments[t],s.select(),e=this.data[t],this.setLabels(e.label,this.options.formatter(e.value,e))},s.prototype.setLabels=function(t,e){var i,s,r,h,n,o,a,l;return i=2*(Math.min(this.el.width()/2,this.el.height()/2)-10)/3,h=1.8*i,r=i/2,s=i/3,this.text1.attr({text:t,transform:""}),n=this.text1.getBBox(),o=Math.min(h/n.width,r/n.height),this.text1.attr({transform:"S"+o+","+o+","+(n.x+n.width/2)+","+(n.y+n.height)}),this.text2.attr({text:e,transform:""}),a=this.text2.getBBox(),l=Math.min(h/a.width,s/a.height),this.text2.attr({transform:"S"+l+","+l+","+(a.x+a.width/2)+","+a.y})},s.prototype.drawEmptyDonutLabel=function(t,e,i,s,r){var h;return h=this.raphael.text(t,e,"").attr("font-size",s).attr("fill",i),null!=r&&h.attr("font-weight",r),h},s}(Morris.EventEmitter),Morris.DonutSegment=function(e){function s(e,i,s,r,h,n,o,a,l,c){this.cx=e,this.cy=i,this.inner=s,this.outer=r,this.color=o,this.backgroundColor=a,this.index=l,this.raphael=c,this.deselect=t(this.deselect,this),this.select=t(this.select,this),this.sin_p0=Math.sin(h),this.cos_p0=Math.cos(h),this.sin_p1=Math.sin(n),this.cos_p1=Math.cos(n),this.is_long=n-h>Math.PI?1:0,this.path=this.calcSegment(this.inner+3,this.inner+this.outer-5),this.selectedPath=this.calcSegment(this.inner+3,this.inner+this.outer),this.hilight=this.calcArc(this.inner)}return i(s,e),s.prototype.calcArcPoints=function(t){return[this.cx+t*this.sin_p0,this.cy+t*this.cos_p0,this.cx+t*this.sin_p1,this.cy+t*this.cos_p1]},s.prototype.calcSegment=function(t,e){var i,s,r,h,n,o,a,l,c,u;return c=this.calcArcPoints(t),i=c[0],r=c[1],s=c[2],h=c[3],u=this.calcArcPoints(e),n=u[0],a=u[1],o=u[2],l=u[3],"M"+i+","+r+("A"+t+","+t+",0,"+this.is_long+",0,"+s+","+h)+("L"+o+","+l)+("A"+e+","+e+",0,"+this.is_long+",1,"+n+","+a)+"Z"},s.prototype.calcArc=function(t){var e,i,s,r,h;return h=this.calcArcPoints(t),e=h[0],s=h[1],i=h[2],r=h[3],"M"+e+","+s+("A"+t+","+t+",0,"+this.is_long+",0,"+i+","+r)},s.prototype.render=function(){return this.arc=this.drawDonutArc(this.hilight,this.color),this.seg=this.drawDonutSegment(this.path,this.color,this.backgroundColor,function(t){return function(){return t.fire("hover",t.index)}}(this),function(t){return function(){return t.fire("click",t.index)}}(this))},s.prototype.drawDonutArc=function(t,e){return this.raphael.path(t).attr({stroke:e,"stroke-width":2,opacity:0})},s.prototype.drawDonutSegment=function(t,e,i,s,r){return this.raphael.path(t).attr({fill:e,stroke:i,"stroke-width":3}).hover(s).click(r)},s.prototype.select=function(){return this.selected?void 0:(this.seg.animate({path:this.selectedPath},150,"<>"),this.arc.animate({opacity:1},150,"<>"),this.selected=!0)},s.prototype.deselect=function(){return this.selected?(this.seg.animate({path:this.path},150,"<>"),this.arc.animate({opacity:0},150,"<>"),this.selected=!1):void 0},s}(Morris.EventEmitter)}).call(this);