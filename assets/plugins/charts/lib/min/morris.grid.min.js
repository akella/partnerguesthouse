(function(){var t={}.hasOwnProperty,i=function(i,e){function s(){this.constructor=i}for(var n in e)t.call(e,n)&&(i[n]=e[n]);return s.prototype=e.prototype,i.prototype=new s,i.__super__=e.prototype,i};Morris.Grid=function(t){function e(t){if(this.el="string"==typeof t.element?$(document.getElementById(t.element)):$(t.element),null==this.el||0===this.el.length)throw new Error("Graph container element not found");"static"===this.el.css("position")&&this.el.css("position","relative"),this.options=$.extend({},this.gridDefaults,this.defaults||{},t),"string"==typeof this.options.units&&(this.options.postUnits=t.units),this.raphael=new Raphael(this.el[0]),this.elementWidth=null,this.elementHeight=null,this.dirty=!1,this.init&&this.init(),this.setData(this.options.data),this.el.bind("mousemove",function(t){return function(i){var e;return e=t.el.offset(),t.fire("hovermove",i.pageX-e.left,i.pageY-e.top)}}(this)),this.el.bind("mouseout",function(t){return function(){return t.fire("hoverout")}}(this)),this.el.bind("touchstart touchmove touchend",function(t){return function(i){var e,s;return s=i.originalEvent.touches[0]||i.originalEvent.changedTouches[0],e=t.el.offset(),t.fire("hover",s.pageX-e.left,s.pageY-e.top),s}}(this)),this.el.bind("click",function(t){return function(i){var e;return e=t.el.offset(),t.fire("gridclick",i.pageX-e.left,i.pageY-e.top)}}(this)),this.postInit&&this.postInit()}return i(e,t),e.prototype.gridDefaults={dateFormat:null,axes:!0,grid:!0,gridLineColor:"#aaa",gridStrokeWidth:.5,gridTextColor:"#888",gridTextSize:12,gridTextFamily:"sans-serif",gridTextWeight:"normal",hideHover:!1,yLabelFormat:null,xLabelAngle:0,numLines:5,padding:25,parseTime:!0,postUnits:"",preUnits:"",ymax:"auto",ymin:"auto 0",goals:[],goalStrokeWidth:1,goalLineColors:["#666633","#999966","#cc6666","#663333"],events:[],eventStrokeWidth:1,eventLineColors:["#005a04","#ccffbb","#3a5f0b","#005502"]},e.prototype.setData=function(t,i){var e,s,n,o,r,a,h,l,p,d,u,m,g,f;return null==i&&(i=!0),this.options.data=t,null==t||0===t.length?(this.data=[],this.raphael.clear(),null!=this.hover&&this.hover.hide(),void 0):(m=this.cumulative?0:null,g=this.cumulative?0:null,this.options.goals.length>0&&(r=Math.min.apply(null,this.options.goals),o=Math.max.apply(null,this.options.goals),g=null!=g?Math.min(g,r):r,m=null!=m?Math.max(m,o):o),this.data=function(){var i,e,o;for(o=[],n=i=0,e=t.length;e>i;n=++i)h=t[n],a={},a.label=h[this.options.xkey],this.options.parseTime?(a.x=Morris.parseDate(a.label),this.options.dateFormat?a.label=this.options.dateFormat(a.x):"number"==typeof a.label&&(a.label=new Date(a.label).toString())):(a.x=n,this.options.xLabelFormat&&(a.label=this.options.xLabelFormat(a))),p=0,a.y=function(){var t,i,e,n;for(e=this.options.ykeys,n=[],s=t=0,i=e.length;i>t;s=++t)u=e[s],f=h[u],"string"==typeof f&&(f=parseFloat(f)),null!=f&&"number"!=typeof f&&(f=null),null!=f&&(this.cumulative?p+=f:null!=m?(m=Math.max(f,m),g=Math.min(f,g)):m=g=f),this.cumulative&&null!=p&&(m=Math.max(p,m),g=Math.min(p,g)),n.push(f);return n}.call(this),o.push(a);return o}.call(this),this.options.parseTime&&(this.data=this.data.sort(function(t,i){return(t.x>i.x)-(i.x>t.x)})),this.xmin=this.data[0].x,this.xmax=this.data[this.data.length-1].x,this.events=[],this.options.parseTime&&this.options.events.length>0&&(this.events=function(){var t,i,s,n;for(s=this.options.events,n=[],t=0,i=s.length;i>t;t++)e=s[t],n.push(Morris.parseDate(e));return n}.call(this),this.xmax=Math.max(this.xmax,Math.max.apply(null,this.events)),this.xmin=Math.min(this.xmin,Math.min.apply(null,this.events))),this.xmin===this.xmax&&(this.xmin-=1,this.xmax+=1),this.ymin=this.yboundary("min",g),this.ymax=this.yboundary("max",m),this.ymin===this.ymax&&(g&&(this.ymin-=1),this.ymax+=1),(this.options.axes===!0||this.options.grid===!0)&&(this.options.ymax===this.gridDefaults.ymax&&this.options.ymin===this.gridDefaults.ymin?(this.grid=this.autoGridLines(this.ymin,this.ymax,this.options.numLines),this.ymin=Math.min(this.ymin,this.grid[0]),this.ymax=Math.max(this.ymax,this.grid[this.grid.length-1])):(l=(this.ymax-this.ymin)/(this.options.numLines-1),this.grid=function(){var t,i,e,s;for(s=[],d=t=i=this.ymin,e=this.ymax;l>0?e>=t:t>=e;d=t+=l)s.push(d);return s}.call(this))),this.dirty=!0,i?this.redraw():void 0)},e.prototype.yboundary=function(t,i){var e,s;return e=this.options["y"+t],"string"==typeof e?"auto"===e.slice(0,4)?e.length>5?(s=parseInt(e.slice(5),10),null==i?s:Math[t](i,s)):null!=i?i:0:parseInt(e,10):e},e.prototype.autoGridLines=function(t,i,e){var s,n,o,r,a,h,l,p,d;return a=i-t,d=Math.floor(Math.log(a)/Math.log(10)),l=Math.pow(10,d),n=Math.floor(t/l)*l,s=Math.ceil(i/l)*l,h=(s-n)/(e-1),1===l&&h>1&&Math.ceil(h)!==h&&(h=Math.ceil(h),s=n+h*(e-1)),0>n&&s>0&&(n=Math.floor(t/h)*h,s=Math.ceil(i/h)*h),1>h?(r=Math.floor(Math.log(h)/Math.log(10)),o=function(){var t,i;for(i=[],p=t=n;h>0?s>=t:t>=s;p=t+=h)i.push(parseFloat(p.toFixed(1-r)));return i}()):o=function(){var t,i;for(i=[],p=t=n;h>0?s>=t:t>=s;p=t+=h)i.push(p);return i}(),o},e.prototype._calc=function(){var t,i,e,s,n,o;return n=this.el.width(),e=this.el.height(),(this.elementWidth!==n||this.elementHeight!==e||this.dirty)&&(this.elementWidth=n,this.elementHeight=e,this.dirty=!1,this.left=this.options.padding,this.right=this.elementWidth-this.options.padding,this.top=this.options.padding,this.bottom=this.elementHeight-this.options.padding,this.options.axes&&(o=function(){var t,e,s,n;for(s=this.grid,n=[],t=0,e=s.length;e>t;t++)i=s[t],n.push(this.measureText(this.yAxisFormat(i)).width);return n}.call(this),this.left+=Math.max.apply(Math,o),t=function(){var t,i,e;for(e=[],s=t=0,i=this.data.length;i>=0?i>t:t>i;s=i>=0?++t:--t)e.push(this.measureText(this.data[s].text,-this.options.xLabelAngle).height);return e}.call(this),this.bottom-=Math.max.apply(Math,t)),this.width=Math.max(1,this.right-this.left),this.height=Math.max(1,this.bottom-this.top),this.dx=this.width/(this.xmax-this.xmin),this.dy=this.height/(this.ymax-this.ymin),this.calc)?this.calc():void 0},e.prototype.transY=function(t){return this.bottom-(t-this.ymin)*this.dy},e.prototype.transX=function(t){return 1===this.data.length?(this.left+this.right)/2:this.left+(t-this.xmin)*this.dx},e.prototype.redraw=function(){return this.raphael.clear(),this._calc(),this.drawGrid(),this.drawGoals(),this.drawEvents(),this.draw?this.draw():void 0},e.prototype.measureText=function(t,i){var e,s;return null==i&&(i=0),s=this.raphael.text(100,100,t).attr("font-size",this.options.gridTextSize).attr("font-family",this.options.gridTextFamily).attr("font-weight",this.options.gridTextWeight).rotate(i),e=s.getBBox(),s.remove(),e},e.prototype.yAxisFormat=function(t){return this.yLabelFormat(t)},e.prototype.yLabelFormat=function(t){return"function"==typeof this.options.yLabelFormat?this.options.yLabelFormat(t):""+this.options.preUnits+Morris.commas(t)+this.options.postUnits},e.prototype.updateHover=function(t,i){var e,s;return e=this.hitTest(t,i),null!=e?(s=this.hover).update.apply(s,e):void 0},e.prototype.drawGrid=function(){var t,i,e,s,n,o;if(this.options.grid!==!1||this.options.axes!==!1){for(n=this.grid,o=[],e=0,s=n.length;s>e;e++)t=n[e],i=this.transY(t),this.options.axes&&this.drawYAxisLabel(this.left-this.options.padding/2,i,this.yAxisFormat(t)),this.options.grid?o.push(this.drawGridLine("M"+this.left+","+i+"H"+(this.left+this.width))):o.push(void 0);return o}},e.prototype.drawGoals=function(){var t,i,e,s,n,o,r;for(o=this.options.goals,r=[],e=s=0,n=o.length;n>s;e=++s)i=o[e],t=this.options.goalLineColors[e%this.options.goalLineColors.length],r.push(this.drawGoal(i,t));return r},e.prototype.drawEvents=function(){var t,i,e,s,n,o,r;for(o=this.events,r=[],e=s=0,n=o.length;n>s;e=++s)i=o[e],t=this.options.eventLineColors[e%this.options.eventLineColors.length],r.push(this.drawEvent(i,t));return r},e.prototype.drawGoal=function(t,i){return this.raphael.path("M"+this.left+","+this.transY(t)+"H"+this.right).attr("stroke",i).attr("stroke-width",this.options.goalStrokeWidth)},e.prototype.drawEvent=function(t,i){return this.raphael.path("M"+this.transX(t)+","+this.bottom+"V"+this.top).attr("stroke",i).attr("stroke-width",this.options.eventStrokeWidth)},e.prototype.drawYAxisLabel=function(t,i,e){return this.raphael.text(t,i,e).attr("font-size",this.options.gridTextSize).attr("font-family",this.options.gridTextFamily).attr("font-weight",this.options.gridTextWeight).attr("fill",this.options.gridTextColor).attr("text-anchor","end")},e.prototype.drawGridLine=function(t){return this.raphael.path(t).attr("stroke",this.options.gridLineColor).attr("stroke-width",this.options.gridStrokeWidth)},e}(Morris.EventEmitter),Morris.parseDate=function(t){var i,e,s,n,o,r,a,h,l,p,d;return"number"==typeof t?t:(e=t.match(/^(\d+) Q(\d)$/),n=t.match(/^(\d+)-(\d+)$/),o=t.match(/^(\d+)-(\d+)-(\d+)$/),a=t.match(/^(\d+) W(\d+)$/),h=t.match(/^(\d+)-(\d+)-(\d+)[ T](\d+):(\d+)(Z|([+-])(\d\d):?(\d\d))?$/),l=t.match(/^(\d+)-(\d+)-(\d+)[ T](\d+):(\d+):(\d+(\.\d+)?)(Z|([+-])(\d\d):?(\d\d))?$/),e?new Date(parseInt(e[1],10),3*parseInt(e[2],10)-1,1).getTime():n?new Date(parseInt(n[1],10),parseInt(n[2],10)-1,1).getTime():o?new Date(parseInt(o[1],10),parseInt(o[2],10)-1,parseInt(o[3],10)).getTime():a?(p=new Date(parseInt(a[1],10),0,1),4!==p.getDay()&&p.setMonth(0,1+(4-p.getDay()+7)%7),p.getTime()+6048e5*parseInt(a[2],10)):h?h[6]?(r=0,"Z"!==h[6]&&(r=60*parseInt(h[8],10)+parseInt(h[9],10),"+"===h[7]&&(r=0-r)),Date.UTC(parseInt(h[1],10),parseInt(h[2],10)-1,parseInt(h[3],10),parseInt(h[4],10),parseInt(h[5],10)+r)):new Date(parseInt(h[1],10),parseInt(h[2],10)-1,parseInt(h[3],10),parseInt(h[4],10),parseInt(h[5],10)).getTime():l?(d=parseFloat(l[6]),i=Math.floor(d),s=Math.round(1e3*(d-i)),l[8]?(r=0,"Z"!==l[8]&&(r=60*parseInt(l[10],10)+parseInt(l[11],10),"+"===l[9]&&(r=0-r)),Date.UTC(parseInt(l[1],10),parseInt(l[2],10)-1,parseInt(l[3],10),parseInt(l[4],10),parseInt(l[5],10)+r,i,s)):new Date(parseInt(l[1],10),parseInt(l[2],10)-1,parseInt(l[3],10),parseInt(l[4],10),parseInt(l[5],10),i,s).getTime()):new Date(parseInt(t,10),0,1).getTime())}}).call(this);